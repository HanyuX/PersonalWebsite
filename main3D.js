function mole(e,t){return t-parseInt(t/e)*e}function generateCube(e,t,n){var r=new Image;r.src=value1;var i=document.createElement("canvas");var s=i.getContext("2d");i.width=r.width;i.height=r.height;s.drawImage(r,0,0);var o=r.width,u=r.height;var a=s.getImageData(0,0,o,u).data;var f=.8;var l=new THREE.SphereGeometry(13,3,2);e=o*u;for(var c=0;c<e&&e>n;c++){n++;var h=new THREE.MeshBasicMaterial({color:5263536});var p=new THREE.MeshBasicMaterial;p.color.r=a[4*c]/255;p.color.g=a[4*c+1]/255;p.color.b=a[4*c+2]/255;var d=new THREE.Mesh(l,p);var v=a[4*c]*.299+a[4*c+1]*.587+a[4*c+2]*.114;d.position.x=parseInt(c/o)*10-1e3;d.position.z=mole(o,c)*10-1e3;d.position.y=1/Math.acos(v/255*f)*200-1e3;if(t){THREE.GeometryUtils.merge(mergedGeo,d)}else{d.matrixAutoUpdate=false;d.updateMatrix();group.addChild(d)}}if(e!==n){setTimeout(function(){generateCube(e,t,n)},0)}if(e===n){if(t){mergedGeo.computeFaceNormals();group=new THREE.Mesh(mergedGeo,h);group.matrixAutoUpdate=false;group.updateMatrix()}scene.addObject(group)}}function init(){container=document.createElement("div");document.body.appendChild(container);var e=location.href.toString().toLowerCase();var t=e.split("&");var n=t[0].indexOf("=");value1=t[0].substr(n+1);n=t[1].indexOf("=");value2=t[1].substr(n+1);camera=new THREE.Camera(60,window.innerWidth/window.innerHeight,1,1e4);camera.position.z=4e3;camera.position.y=2500;camera.position.x=1500;scene=new THREE.Scene;scene.fog=new THREE.Fog(16777215,2500,1e4);var r=urlHashJSON.read()||{};r.nCubes=1e3;if(value2.valueOf()=="false".valueOf())r.doMerge=false;else r.doMerge=true;var i=r.nCubes;var s=r.doMerge;urlHashJSON.write(r);group=new THREE.Object3D;mergedGeo=new THREE.Geometry;setTimeout(function(){generateCube(i,s,0)},0);renderer=new THREE.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight);renderer.sortObjects=false;container.appendChild(renderer.domElement);stats=new Stats;stats.domElement.style.position="absolute";stats.domElement.style.top="0px";stats.domElement.style.zIndex=100;container.appendChild(stats.domElement)}function onDocumentMouseMove(e){mouseX=(e.clientX-windowHalfX)*10;mouseY=(e.clientY-windowHalfY)*10}function animate(){requestAnimationFrame(animate);render();stats.update()}function render(){var e=Math.sin((new Date).getTime()*7e-4)*.5;var t=Math.sin((new Date).getTime()*3e-4)*.5;var n=Math.sin((new Date).getTime()*2e-4)*.5;camera.position.x+=150+(mouseX-camera.position.x)*.05;camera.position.y+=(-mouseY-camera.position.y)*.05;group.rotation.x=e;group.rotation.y=t;group.rotation.z=n;renderer.render(scene,camera)}var container,stats;var camera,scene,renderer;var mergedGeo;var geometry,group;var mouseX=0,mouseY=0;var value1,value2;var windowHalfX=window.innerWidth/2;var windowHalfY=window.innerHeight/2;document.addEventListener("mousemove",onDocumentMouseMove,false);var urlHashJSON={read:function(){if(!window.location.hash)return undefined;var e=window.location.hash.substring(1);var t=JSON.parse(decodeURIComponent(e));return t},write:function(e){var t=encodeURIComponent(JSON.stringify(e));window.location.hash="#"+t}};init();animate()